# 西浦博士生非官方指南小程序导航系统实现方案

## 1. 导航系统整体架构

西浦博士生非官方指南小程序采用了分层式导航系统，主要包含以下几个部分：

1. **底部TabBar导航**：通过微信小程序原生tabBar实现，包含"指南"和"我"两个主要入口
2. **折叠式顶部导航**：自定义实现的双层导航组件，包含章节(一级)和小节(二级)两级导航结构
3. **交叉观察器自动追踪**：使用IntersectionObserver实现内容阅读位置的自动检测和导航状态更新
4. **阅读位置记忆**：保存用户上次阅读位置，支持下次打开时恢复到之前的阅读进度

## 2. 导航数据结构

导航采用JSON格式组织，遵循以下结构：

```json
{
  "chapters": [
    {
      "id": "1",
      "title": "章节标题",
      "title_en": "Chapter Title", // 英文标题支持
      "sections": [
        {
          "id": "1-1",
          "title": "小节标题",
          "title_en": "Section Title", // 英文标题支持
          "contents": [
            // 内容数组
          ]
        }
      ]
    }
  ]
}
```

此结构由`constants.js`中的`NavigationData`对象提供，作为整个应用的内容数据源。

## 3. 导航模块功能组成

导航系统通过`/pages/index/modules/navigation.js`模块实现，主要包含以下功能：

### 3.1 导航初始化

- `initNavigation(page)`：将导航相关方法绑定到页面实例
- `initializeDefaultChapter()`：初始化默认选中的章节和小节

### 3.2 导航位置跟踪

- `setupIntersectionObservers()`：设置交叉观察器监测章节和小节的可见性
- `setupChapterObserver(chapter, observerMap)`：为每个章节设置观察器
- `setupSectionObservers(chapter, observerMap)`：为每个小节设置观察器
- `onPageScroll(e)`：处理页面滚动，控制二级导航的显示/隐藏

### 3.3 导航交互处理

- `selectChapter(e)`：处理章节选择，更新UI并滚动到对应位置
- `selectSection(e)`：处理小节选择，更新UI并滚动到对应位置
- `toggleNavigation()`：切换导航栏的显示/隐藏状态

### 3.4 阅读位置管理

- `saveReadingPosition(chapterId, sectionId)`：保存当前阅读位置
- `restoreReadingPosition(lastPosition)`：恢复之前的阅读位置

## 4. 交互逻辑实现

### 4.1 章节导航交互

- 点击一级导航项，显示对应章节内容和二级导航
- 自动选中该章节的第一个小节
- 滚动到对应章节位置
- 当前选中的章节保持高亮状态

### 4.2 小节导航交互

- 点击二级导航项，滚动到对应小节位置
- 当前选中的小节保持高亮状态
- 向下滚动页面时，二级导航自动隐藏以节省屏幕空间
- 向上滚动页面时，二级导航自动显示

### 4.3 自动位置追踪

- 通过IntersectionObserver监测当前在视口中的章节和小节
- 自动更新导航高亮状态和导航位置
- 自动保存当前阅读位置

## 5. 响应式设计

导航系统会根据不同设备和屏幕状态调整布局：

- **横屏模式**：导航栏固定在左侧，垂直排列
- **竖屏模式**：导航栏固定在顶部，水平排列
- **小屏幕**：优化导航项大小和间距，支持滚动
- **大屏幕**：提供更多视觉空间，优化导航体验

## 6. 适老化支持

导航系统适配了适老化设计原则：

- 增大导航项的点击区域，提高易用性
- 适老化模式下使用更大的字体和更高的对比度
- 为导航元素提供足够明显的视觉反馈

## 7. 优化方向

当前导航系统有以下潜在优化方向：

- 为导航组件添加搜索功能，快速定位内容
- 增加章节收藏功能，方便快速访问常用内容
- 优化IntersectionObserver性能，减少页面卡顿
- 支持更丰富的手势操作，如滑动切换章节
- 动态加载导航数据，支持远程更新内容结构